/*
 * Copyright (c) 2018-2019 Arm Limited.
 *
 * SPDX-License-Identifier: MIT
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
#ifdef __aarch64__

#include <algorithm>

#include "arm_gemm.hpp"

#include "../../asmlib.hpp"
#include "../../utils.hpp"

namespace arm_gemm {

void a64_hybrid_fp32_mla_4x8(const float *A, int lda, const float *B, float *C, int ldc, int M, int N, int K, const float *bias, Activation act, bool append) {
    const int K_stride = K;
    const long loops_count = ((K + 4) / 8) - 1;
    K -= loops_count * 8;
    const long regs_count = (K / 4) - 1;
    K -= (regs_count + 1) * 4;
    const long blocks_count = K / 1;
    float nullbias[4];
    if (!append && !bias) {
        memset(nullbias, 0, (4 * sizeof(float)));
    }
    float minval = - static_cast<float>(std::numeric_limits<float>::infinity());
    float maxval =   static_cast<float>(std::numeric_limits<float>::infinity());
    const float * const minptr = &minval;
    const float * const maxptr = &maxval;

    switch(act.type)
    {
        default:
        case Activation::Type::None:
            break;
        case Activation::Type::BoundedReLU:
            maxval = static_cast<float>(act.param1);
            /* fall through */
        case Activation::Type::ReLU:
            minval = 0.0f;
            break;
    }

    for (int y=0; y<M; y+=8) {
        const float * const a_ptr0_base = A + (y * lda);
        const unsigned long ldab = lda * sizeof(float);

        float *c_ptr0 = C + (y * ldc);

        for (int x0=0; x0<N; x0+=4ul) {
            const long width = std::min((unsigned long)N-x0, 4ul);
            long loops = loops_count;
            long regs = regs_count;
            long blocks = blocks_count;
            const float *a_ptr0 = a_ptr0_base;
            const float *b_ptr0 = B + (K_stride * x0);
            const bool use_result_buffer = (width < 4);
            float result_buffer[32];
            const unsigned long ldcb = (use_result_buffer ? 4 : ldc) * sizeof(float);
            float *c_ptr_real = c_ptr0;
            if (use_result_buffer && append) {
                for(int cy=0; cy<std::min(M-y, 8); cy++) {
                    for(unsigned int cx=0; cx<width; cx++) {
                        result_buffer[cy * 4 + cx] = c_ptr_real[cy * ldc + cx];
                    }
                }
            }
            if (use_result_buffer) {
                c_ptr0 = result_buffer;
            }
            const float *biasptr = bias ? bias+x0 : nullbias;

            /*riscv*/
    		float s[4] = {0,0,0,0};
    		float *s0 = s;
    		float *s1 = s0 + 1;
    		float *s2 = s1 + 1;
    		float *s3 = s2 + 1;

            switch(M-y) {
                case 1:
        	__asm__ __volatile__(
			"li  a0, 4\n"
			"vsetvli  t0, a0, e32, m1\n"
			
			"vle32.v          v24, (%[biasptr])\n"
			"vle32.v          v0, (%[a_ptr0])\n"
			"add %[a_ptr0], %[a_ptr0], 0x10\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x40\n"
			"beqz %[loops], 1f\n"
			"2:\n"
			"add            a1, %[b_ptr0], -0x10\n"
			"vle32.v          v19, (a1)\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vle32.v          v8, (%[a_ptr0])\n"
			"addi %[loops], %[loops], -0x1\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add %[a_ptr0], %[a_ptr0], 0x20\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add            a1, %[b_ptr0], 0x30\n"
			"vle32.v          v19, (a1)\n"
			"add            a1, %[a_ptr0], -0x10\n"
			"vle32.v          v0, (a1)\n"
			
			"vse32.v          v8, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"add            a1, %[b_ptr0], 0x40\n"
			"vle32.v          v16, (a1)\n"
			"add            a1, %[b_ptr0], 0x50\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x60\n"
			"vle32.v          v18, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x80\n"
			"bnez           %[loops], 2b\n"
			"1:\n"
			"add            a1, %[b_ptr0], -0x10\n"
			"vle32.v          v19, (a1)\n"
			"beqz            %[regs], 3f\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vle32.v          v8, (%[a_ptr0])\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add %[a_ptr0], %[a_ptr0], 0x10\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add            a1, %[b_ptr0], 0x30\n"
			"vle32.v          v19, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x40\n"
			"vse32.v          v8, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"j              4f\n"
			"3:\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"4:\n"
			"beqz %[blocks], 5f\n"
			"6:\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"addi %[blocks], %[blocks], -0x1\n"
			"add %[b_ptr0], %[b_ptr0], 0x10\n"
			"vle32.v          v0, (%[a_ptr0])\n"
			"add %[a_ptr0], %[a_ptr0], 0x4\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"bnez           %[blocks], 6b\n"
			"5:\n"
                        "flw            f0, (%[minptr])\n"
                        "vfmv.v.f          v22, f0\n"
                        "flw            f0, (%[maxptr])\n"
                        "vfmv.v.f          v23, f0\n"
			"vfmax.vv v24, v24, v22\n"
			"vfmin.vv v24, v24, v23\n"
			"vse32.v v24, (%[c_ptr0])\n"
			"add %[c_ptr0], %[c_ptr0], 0x10\n"
			
		: [a_ptr0] "+r" (a_ptr0), [b_ptr0] "+r" (b_ptr0), [c_ptr0] "+r" (c_ptr0), [loops] "+r" (loops), [regs] "+r" (regs), [blocks] "+r" (blocks), [s0] "+r" (s0), [s1] "+r" (s1), [s2] "+r" (s2), [s3] "+r" (s3)
		: [width] "r" (width), [append] "r" (static_cast<uint64_t>(append)), [lda] "r" (ldab), [ldc] "r" (ldcb), [biasptr] "r" (biasptr), [minptr] "r" (minptr), [maxptr] "r" (maxptr)
		: "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7", "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15", "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23", "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31",
		  "t0", "a0", "a1", "f0"
		);
                    break;
                case 2:
        	__asm__ __volatile__(
			"li  a0, 4\n"
			"vsetvli  t0, a0, e32, m1\n"
			
			"vle32.v          v24, (%[biasptr])\n"
			"add a2, %[a_ptr0], %[lda]\n"
			"vle32.v          v0, (%[a_ptr0])\n"
			"vmv.v.v v25, v24\n"
			"vle32.v          v1, (a2)\n"
			"add %[a_ptr0], %[a_ptr0], 0x10\n"
			"add a2, a2, 0x10\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x40\n"
			"beqz %[loops], 1f\n"
			"2:\n"
			"add            a1, %[b_ptr0], -0x10\n"
			"vle32.v          v19, (a1)\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vle32.v          v8, (%[a_ptr0])\n"
			"vle32.v          v9, (a2)\n"
			"addi %[loops], %[loops], -0x1\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add %[a_ptr0], %[a_ptr0], 0x20\n"
			"add a2, a2, 0x20\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add            a1, %[b_ptr0], 0x30\n"
			"vle32.v          v19, (a1)\n"
			"add            a1, %[a_ptr0], -0x10\n"
			"vle32.v          v0, (a1)\n"
			"add            a1, a2, -0x10\n"
			"vle32.v          v1, (a1)\n"
			"vse32.v          v8, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v9, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"add            a1, %[b_ptr0], 0x40\n"
			"vle32.v          v16, (a1)\n"
			"add            a1, %[b_ptr0], 0x50\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x60\n"
			"vle32.v          v18, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x80\n"
			"bnez           %[loops], 2b\n"
			"1:\n"
			"add            a1, %[b_ptr0], -0x10\n"
			"vle32.v          v19, (a1)\n"
			"beqz            %[regs], 3f\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vle32.v          v8, (%[a_ptr0])\n"
			"vle32.v          v9, (a2)\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add %[a_ptr0], %[a_ptr0], 0x10\n"
			"add a2, a2, 0x10\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add            a1, %[b_ptr0], 0x30\n"
			"vle32.v          v19, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x40\n"
			"vse32.v          v8, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v9, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"j              4f\n"
			"3:\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"4:\n"
			"beqz %[blocks], 5f\n"
			"6:\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"addi %[blocks], %[blocks], -0x1\n"
			"add %[b_ptr0], %[b_ptr0], 0x10\n"
			"vle32.v          v0, (%[a_ptr0])\n"
			"add %[a_ptr0], %[a_ptr0], 0x4\n"
			"vle32.v          v1, (a2)\n"
			"add a2, a2, 0x4\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"bnez           %[blocks], 6b\n"
			"5:\n"
                        "flw            f0, (%[minptr])\n"
                        "vfmv.v.f          v22, f0\n"
                        "flw            f0, (%[maxptr])\n"
                        "vfmv.v.f          v23, f0\n"
			"vfmax.vv v24, v24, v22\n"
			"vfmax.vv v25, v25, v22\n"
			"vfmin.vv v24, v24, v23\n"
			"vfmin.vv v25, v25, v23\n"
			"vse32.v v24, (%[c_ptr0])\n"
			"add a1, %[c_ptr0], %[ldc]\n"
			"vse32.v v25, (a1)\n"
			"add %[c_ptr0], %[c_ptr0], 0x10\n"

		: [a_ptr0] "+r" (a_ptr0), [b_ptr0] "+r" (b_ptr0), [c_ptr0] "+r" (c_ptr0), [loops] "+r" (loops), [regs] "+r" (regs), [blocks] "+r" (blocks), [s0] "+r" (s0), [s1] "+r" (s1), [s2] "+r" (s2), [s3] "+r" (s3)
		: [width] "r" (width), [append] "r" (static_cast<uint64_t>(append)), [lda] "r" (ldab), [ldc] "r" (ldcb), [biasptr] "r" (biasptr), [minptr] "r" (minptr), [maxptr] "r" (maxptr)
		: "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7", "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15", "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23", "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31",
		  "t0", "a0", "a1", "a2", "f0"
		);
                    break;
                case 3:
       		__asm__ __volatile__(
			"li  a0, 4\n"
			"vsetvli  t0, a0, e32, m1\n"
			
			"vle32.v          v24, (%[biasptr])\n"
			"add a2, %[a_ptr0], %[lda]\n"
			"vle32.v          v0, (%[a_ptr0])\n"
			"add a4, a2, %[lda]\n"
			"vmv.v.v v25, v24\n"
			"vmv.v.v v26, v24\n"
			"vle32.v          v1, (a2)\n"
			"vle32.v          v2, (a4)\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add %[a_ptr0], %[a_ptr0], 0x10\n"
			"add a2, a2, 0x10\n"
			"add a4, a4, 0x10\n"
			"add %[b_ptr0], %[b_ptr0], 0x40\n"
			"beqz %[loops], 1f\n"
			"2:\n"
			"add            a1, %[b_ptr0], -0x10\n"
			"vle32.v          v19, (a1)\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vle32.v          v8, (%[a_ptr0])\n"
			"vle32.v          v9, (a2)\n"
			"vle32.v          v10, (a4)\n"
			"addi %[loops], %[loops], -0x1\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add %[a_ptr0], %[a_ptr0], 0x20\n"
			"add a2, a2, 0x20\n"
			"add a4, a4, 0x20\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add            a1, %[b_ptr0], 0x30\n"
			"vle32.v          v19, (a1)\n"
			"add            a1, %[a_ptr0], -0x10\n"
			"vle32.v          v0, (a1)\n"
			"add            a1, a2, -0x10\n"
			"vle32.v          v1, (a1)\n"
			"add            a1, a4, -0x10\n"
			"vle32.v          v2, (a1)\n"
			
			"vse32.v          v8, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v9, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v10, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"add            a1, %[b_ptr0], 0x40\n"
			"vle32.v          v16, (a1)\n"
			"add            a1, %[b_ptr0], 0x50\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x60\n"
			"vle32.v          v18, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x80\n"
			"bnez           %[loops], 2b\n"
			"1:\n"
			"add            a1, %[b_ptr0], -0x10\n"
			"vle32.v          v19, (a1)\n"
			"beqz            %[regs], 3f\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vle32.v          v8, (%[a_ptr0])\n"
			"vle32.v          v9, (a2)\n"
			"vle32.v          v10, (a4)\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add %[a_ptr0], %[a_ptr0], 0x10\n"
			"add a2, a2, 0x10\n"
			"add a4, a4, 0x10\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add            a1, %[b_ptr0], 0x30\n"
			"vle32.v          v19, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x40\n"
			"vse32.v          v8, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v9, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v10, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"j              4f\n"
			"3:\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"4:\n"
			"beqz %[blocks], 5f\n"
			"6:\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add %[b_ptr0], %[b_ptr0], 0x10\n"
			"vle32.v          v0, (%[a_ptr0])\n"
			"add %[a_ptr0], %[a_ptr0], 0x4\n"
			"vle32.v          v1, (a2)\n"
			"add a2, a2, 0x4\n"
			"vle32.v          v2, (a4)\n"
			"add a4, a4, 0x4\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"addi %[blocks], %[blocks], -0x1\n"
			"bnez           %[blocks], 6b\n"
			"5:\n"
                        "flw            f0, (%[minptr])\n"
                        "vfmv.v.f          v22, f0\n"
                        "flw            f0, (%[maxptr])\n"
                        "vfmv.v.f          v23, f0\n"
			"vfmax.vv v24, v24, v22\n"
			"vfmax.vv v25, v25, v22\n"
			"vfmax.vv v26, v26, v22\n"
			"vfmin.vv v24, v24, v23\n"
			"vfmin.vv v25, v25, v23\n"
			"vfmin.vv v26, v26, v23\n"
			"vse32.v v24, (%[c_ptr0])\n"
			"add a1, %[c_ptr0], %[ldc]\n"
			"vse32.v v25, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v26, (a1)\n"
			"add %[c_ptr0], %[c_ptr0], 0x10\n"
			
			: [a_ptr0] "+r" (a_ptr0), [b_ptr0] "+r" (b_ptr0), [c_ptr0] "+r" (c_ptr0), [loops] "+r" (loops), [regs] "+r" (regs), [blocks] "+r" (blocks), [s0] "+r" (s0), [s1] "+r" (s1), [s2] "+r" (s2), [s3] "+r" (s3)
			: [width] "r" (width), [append] "r" (static_cast<uint64_t>(append)), [lda] "r" (ldab), [ldc] "r" (ldcb), [biasptr] "r" (biasptr), [minptr] "r" (minptr), [maxptr] "r" (maxptr)
			: "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7", "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15", "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23", "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31",
			  "t0", "a0", "a1", "a2", "a4","f0"
			);
                    break;
                case 4:
		__asm__ __volatile__(
			"li  a0, 4\n"
			"vsetvli  t0, a0, e32, m1\n"
			
			"vle32.v          v24, (%[biasptr])\n"
			"add a2, %[a_ptr0], %[lda]\n"
			"vle32.v          v0, (%[a_ptr0])\n"
			"add a4, a2, %[lda]\n"
			"add a6, a4, %[lda]\n"
			"vmv.v.v v25, v24\n"
			"vmv.v.v v26, v24\n"
			"vmv.v.v v27, v24\n"
			"vle32.v          v1, (a2)\n"
			"vle32.v          v2, (a4)\n"
			"vle32.v          v3, (a6)\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add %[a_ptr0], %[a_ptr0], 0x10\n"
			"add a2, a2, 0x10\n"
			"add a4, a4, 0x10\n"
			"add a6, a6, 0x10\n"
			"add %[b_ptr0], %[b_ptr0], 0x40\n"
			"beqz %[loops], 1f\n"
			"2:\n"
			"add            a1, %[b_ptr0], -0x10\n"
			"vle32.v          v19, (a1)\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vle32.v          v8, (%[a_ptr0])\n"
			"vle32.v          v9, (a2)\n"
			"vle32.v          v10, (a4)\n"
			"vle32.v          v11, (a6)\n"
			"addi %[loops], %[loops], -0x1\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add %[a_ptr0], %[a_ptr0], 0x20\n"
			"add a2, a2, 0x20\n"
			"add a4, a4, 0x20\n"
			"add a6, a6, 0x20\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add            a1, %[b_ptr0], 0x30\n"
			"vle32.v          v19, (a1)\n"
			"add            a1, %[a_ptr0], -0x10\n"
			"vle32.v          v0, (a1)\n"
			"add            a1, a2, -0x10\n"
			"vle32.v          v1, (a1)\n"
			"add            a1, a4, -0x10\n"
			"vle32.v          v2, (a1)\n"
			"add            a1, a6, -0x10\n"
			"vle32.v          v3, (a1)\n"
			
			"vse32.v          v8, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v9, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v10, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v11, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"add            a1, %[b_ptr0], 0x40\n"
			"vle32.v          v16, (a1)\n"
			"add            a1, %[b_ptr0], 0x50\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x60\n"
			"vle32.v          v18, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x80\n"
			"bnez           %[loops], 2b\n"
			"1:\n"
			"add            a1, %[b_ptr0], -0x10\n"
			"vle32.v          v19, (a1)\n"
			"beqz           %[regs], 3f\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vle32.v          v8, (%[a_ptr0])\n"
			"vle32.v          v9, (a2)\n"
			"vle32.v          v10, (a4)\n"
			"vle32.v          v11, (a6)\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add %[a_ptr0], %[a_ptr0], 0x10\n"
			"add a2, a2, 0x10\n"
			"add a4, a4, 0x10\n"
			"add a6, a6, 0x10\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add            a1, %[b_ptr0], 0x30\n"
			"vle32.v          v19, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x40\n"
			"vse32.v          v8, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v9, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v10, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v11, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			
			"j              4f\n"
			"3:\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"4:\n"
			"beqz %[blocks], 5f\n"
			"6:\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add %[b_ptr0], %[b_ptr0], 0x10\n"
			"vle32.v          v0, (%[a_ptr0])\n"
			"add %[a_ptr0], %[a_ptr0], 0x4\n"
			"vle32.v          v1, (a2)\n"
			"add a2, a2, 0x4\n"
			"vle32.v          v2, (a4)\n"
			"add a4, a4, 0x4\n"
			"vle32.v          v3, (a6)\n"
			"add a6, a6, 0x4\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"addi %[blocks], %[blocks], -0x1\n"
			"bnez           %[blocks], 6b\n"
			"5:\n"
                        "flw            f0, (%[minptr])\n"
                        "vfmv.v.f          v22, f0\n"
                        "flw            f0, (%[maxptr])\n"
                        "vfmv.v.f          v23, f0\n"
			"vfmax.vv v24, v24, v22\n"
			"vfmax.vv v25, v25, v22\n"
			"vfmax.vv v26, v26, v22\n"
			"vfmax.vv v27, v27, v22\n"
			"vfmin.vv v24, v24, v23\n"
			"vfmin.vv v25, v25, v23\n"
			"vfmin.vv v26, v26, v23\n"
			"vfmin.vv v27, v27, v23\n"
			"vse32.v v24, (%[c_ptr0])\n"
			"add a1, %[c_ptr0], %[ldc]\n"
			"vse32.v v25, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v26, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v27, (a1)\n"
			"add %[c_ptr0], %[c_ptr0], 0x10\n"

			: [a_ptr0] "+r" (a_ptr0), [b_ptr0] "+r" (b_ptr0), [c_ptr0] "+r" (c_ptr0), [loops] "+r" (loops), [regs] "+r" (regs), [blocks] "+r" (blocks), [s0] "+r" (s0), [s1] "+r" (s1), [s2] "+r" (s2), [s3] "+r" (s3)
			: [width] "r" (width), [append] "r" (static_cast<uint64_t>(append)), [lda] "r" (ldab), [ldc] "r" (ldcb), [biasptr] "r" (biasptr), [minptr] "r" (minptr), [maxptr] "r" (maxptr)
			: "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7", "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15", "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23", "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31",
			  "t0", "a0", "a1", "a2", "a4", "a6", "f0"
			);
                    break;
                case 5:
	       __asm__ __volatile__(
			"li  a0, 4\n"
			"vsetvli  t0, a0, e32, m1\n"
			
			"vle32.v          v24, (%[biasptr])\n"
			"add a2, %[a_ptr0], %[lda]\n"
			"vle32.v          v0, (%[a_ptr0])\n"
			"add a4, a2, %[lda]\n"
			"add a6, a4, %[lda]\n"
			"add t1, a6, %[lda]\n"
			"vmv.v.v v25, v24\n"
			"vmv.v.v v26, v24\n"
			"vmv.v.v v27, v24\n"
			"vmv.v.v v28, v24\n"
			"vle32.v          v1, (a2)\n"
			"vle32.v          v2, (a4)\n"
			"vle32.v          v3, (a6)\n"
			"vle32.v          v4, (t1)\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add %[a_ptr0], %[a_ptr0], 0x10\n"
			"add a2, a2, 0x10\n"
			"add a4, a4, 0x10\n"
			"add a6, a6, 0x10\n"
			"add t1, t1, 0x10\n"
			"add %[b_ptr0], %[b_ptr0], 0x40\n"
			"beqz %[loops], 1f\n"
			"2:\n"
			"add            a1, %[b_ptr0], -0x10\n"
			"vle32.v          v19, (a1)\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v4, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"vle32.v          v8, (%[a_ptr0])\n"
			"vle32.v          v9, (a2)\n"
			"vle32.v          v10, (a4)\n"
			"vle32.v          v11, (a6)\n"
			"vle32.v          v12, (t1)\n"
			"addi %[loops], %[loops], -0x1\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add %[a_ptr0], %[a_ptr0], 0x20\n"
			"add a2, a2, 0x20\n"
			"add a4, a4, 0x20\n"
			"add a6, a6, 0x20\n"
			"add t1, t1, 0x20\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add            a1, %[b_ptr0], 0x30\n"
			"vle32.v          v19, (a1)\n"
			"add            a1, %[a_ptr0], -0x10\n"
			"vle32.v          v0, (a1)\n"
			"add            a1, a2, -0x10\n"
			"vle32.v          v1, (a1)\n"
			"add            a1, a4, -0x10\n"
			"vle32.v          v2, (a1)\n"
			"add            a1, a6, -0x10\n"
			"vle32.v          v3, (a1)\n"
			"add            a1, t1, -0x10\n"
			"vle32.v          v4, (a1)\n"
			
			"vse32.v          v8, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v9, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v10, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v11, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v12, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"add            a1, %[b_ptr0], 0x40\n"
			"vle32.v          v16, (a1)\n"
			"add            a1, %[b_ptr0], 0x50\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x60\n"
			"vle32.v          v18, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x80\n"
			"bnez           %[loops], 2b\n"
			"1:\n"
			"add            a1, %[b_ptr0], -0x10\n"
			"vle32.v          v19, (a1)\n"
			"beqz           %[regs], 3f\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v4, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"vle32.v          v8, (%[a_ptr0])\n"
			"vle32.v          v9, (a2)\n"
			"vle32.v          v10, (a4)\n"
			"vle32.v          v11, (a6)\n"
			"vle32.v          v12, (t1)\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add %[a_ptr0], %[a_ptr0], 0x10\n"
			"add a2, a2, 0x10\n"
			"add a4, a4, 0x10\n"
			"add a6, a6, 0x10\n"
			"add t1, t1, 0x10\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add            a1, %[b_ptr0], 0x30\n"
			"vle32.v          v19, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x40\n"
			"vse32.v          v8, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v9, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v10, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v11, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v12, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			
			"j              4f\n"
			"3:\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v4, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"4:\n"
			"beqz %[blocks], 5f\n"
			"6:\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add %[b_ptr0], %[b_ptr0], 0x10\n"
			"vle32.v          v0, (%[a_ptr0])\n"
			"add %[a_ptr0], %[a_ptr0], 0x4\n"
			"vle32.v          v1, (a2)\n"
			"add a2, a2, 0x4\n"
			"vle32.v          v2, (a4)\n"
			"add a4, a4, 0x4\n"
			"vle32.v          v3, (a6)\n"
			"add a6, a6, 0x4\n"
			"vle32.v          v4, (t1)\n"
			"add t1, t1, 0x4\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"vse32.v          v4, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"addi %[blocks], %[blocks], -0x1\n"
			"bnez           %[blocks], 6b\n"
			"5:\n"
                        "flw            f0, (%[minptr])\n"
                        "vfmv.v.f          v22, f0\n"
                        "flw            f0, (%[maxptr])\n"
                        "vfmv.v.f          v23, f0\n"
			"vfmax.vv v24, v24, v22\n"
			"vfmax.vv v25, v25, v22\n"
			"vfmax.vv v26, v26, v22\n"
			"vfmax.vv v27, v27, v22\n"
			"vfmax.vv v28, v28, v22\n"
			"vfmin.vv v24, v24, v23\n"
			"vfmin.vv v25, v25, v23\n"
			"vfmin.vv v26, v26, v23\n"
			"vfmin.vv v27, v27, v23\n"
			"vfmin.vv v28, v28, v23\n"
			"vse32.v v24, (%[c_ptr0])\n"
		    "add a1, %[c_ptr0], %[ldc]\n"
		    "vse32.v v25, (a1)\n"
		    "add a1, a1, %[ldc]\n"
		    "vse32.v v26, (a1)\n"
		    "add a1, a1, %[ldc]\n"
		    "vse32.v v27, (a1)\n"
	   	    "add a1, a1, %[ldc]\n"
		    "vse32.v v28, (a1)\n"
		    "add %[c_ptr0], %[c_ptr0], 0x10\n"

			: [a_ptr0] "+r" (a_ptr0), [b_ptr0] "+r" (b_ptr0), [c_ptr0] "+r" (c_ptr0), [loops] "+r" (loops), [regs] "+r" (regs), [blocks] "+r" (blocks), [s0] "+r" (s0), [s1] "+r" (s1), [s2] "+r" (s2), [s3] "+r" (s3)
			: [width] "r" (width), [append] "r" (static_cast<uint64_t>(append)), [lda] "r" (ldab), [ldc] "r" (ldcb), [biasptr] "r" (biasptr), [minptr] "r" (minptr), [maxptr] "r" (maxptr)
			: "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7", "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15", "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23", "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31",
			  "t0", "t1", "a0", "a1", "a2",  "a4", "a6", "f0"
			);
                    break;
                case 6:
    	    	__asm__ __volatile__(
			"li  a0, 4\n"
			"vsetvli  t0, a0, e32, m1\n"
			
			"vle32.v          v24, (%[biasptr])\n"
			"add a2, %[a_ptr0], %[lda]\n"
			"vle32.v          v0, (%[a_ptr0])\n"
			"add a4, a2, %[lda]\n"
			"add a6, a4, %[lda]\n"
			"add t1, a6, %[lda]\n"
			"add t3, t1, %[lda]\n"
			"vmv.v.v v25, v24\n"
			"vmv.v.v v26, v24\n"
			"vmv.v.v v27, v24\n"
			"vmv.v.v v28, v24\n"
			"vmv.v.v v29, v24\n"
			"vle32.v          v1, (a2)\n"
			"vle32.v          v2, (a4)\n"
			"vle32.v          v3, (a6)\n"
			"vle32.v          v4, (t1)\n"
			"vle32.v          v5, (t3)\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add %[a_ptr0], %[a_ptr0], 0x10\n"
			"add a2, a2, 0x10\n"
			"add a4, a4, 0x10\n"
			"add a6, a6, 0x10\n"
			"add t1, t1, 0x10\n"
			"add t3, t3, 0x10\n"
			"add %[b_ptr0], %[b_ptr0], 0x40\n"
			"beqz %[loops], 1f\n"
			"2:\n"
			"add            a1, %[b_ptr0], -0x10\n"
			"vle32.v          v19, (a1)\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v4, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"vse32.v          v5, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v29, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v29, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v29, f0, v19\n"
			"vle32.v          v8, (%[a_ptr0])\n"
			"vle32.v          v9, (a2)\n"
			"vle32.v          v10, (a4)\n"
			"vle32.v          v11, (a6)\n"
			"vle32.v          v12, (t1)\n"
			"vle32.v          v13, (t3)\n"
			"addi %[loops], %[loops], -0x1\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add %[a_ptr0], %[a_ptr0], 0x20\n"
			"add a2, a2, 0x20\n"
			"add a4, a4, 0x20\n"
			"add a6, a6, 0x20\n"
			"add t1, t1, 0x20\n"
			"add t3, t3, 0x20\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add            a1, %[b_ptr0], 0x30\n"
			"vle32.v          v19, (a1)\n"
			"add            a1, %[a_ptr0], -0x10\n"
			"vle32.v          v0, (a1)\n"
			"add            a1, a2, -0x10\n"
			"vle32.v          v1, (a1)\n"
			"add            a1, a4, -0x10\n"
			"vle32.v          v2, (a1)\n"
			"add            a1, a6, -0x10\n"
			"vle32.v          v3, (a1)\n"
			"add            a1, t1, -0x10\n"
			"vle32.v          v4, (a1)\n"
			"add            a1, t3, -0x10\n"
			"vle32.v          v5, (a1)\n"
			
			"vse32.v          v8, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v9, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v10, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v11, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v12, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"vse32.v          v13, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v29, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v29, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v29, f0, v19\n"
			"add            a1, %[b_ptr0], 0x40\n"
			"vle32.v          v16, (a1)\n"
			"add            a1, %[b_ptr0], 0x50\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x60\n"
			"vle32.v          v18, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x80\n"
			"bnez           %[loops], 2b\n"
			"1:\n"
			"add            a1, %[b_ptr0], -0x10\n"
			"vle32.v          v19, (a1)\n"
			"beqz           %[regs], 3f\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v4, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"vse32.v          v5, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v29, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v29, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v29, f0, v19\n"
			"vle32.v          v8, (%[a_ptr0])\n"
			"vle32.v          v9, (a2)\n"
			"vle32.v          v10, (a4)\n"
			"vle32.v          v11, (a6)\n"
			"vle32.v          v12, (t1)\n"
			"vle32.v          v13, (t3)\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add %[a_ptr0], %[a_ptr0], 0x10\n"
			"add a2, a2, 0x10\n"
			"add a4, a4, 0x10\n"
			"add a6, a6, 0x10\n"
			"add t1, t1, 0x10\n"
			"add t3, t3, 0x10\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add            a1, %[b_ptr0], 0x30\n"
			"vle32.v          v19, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x40\n"
			"vse32.v          v8, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v9, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v10, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v11, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v12, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"vse32.v          v13, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v29, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v29, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v29, f0, v19\n"
			"j              4f\n"
			"3:\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v4, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"vse32.v          v5, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v29, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v29, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v29, f0, v19\n"
			"4:\n"
			"beqz %[blocks], 5f\n"
			"6:\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add %[b_ptr0], %[b_ptr0], 0x10\n"
			"vle32.v          v0, (%[a_ptr0])\n"
			"add %[a_ptr0], %[a_ptr0], 0x4\n"
			"vle32.v          v1, (a2)\n"
			"add a2, a2, 0x4\n"
			"vle32.v          v2, (a4)\n"
			"add a4, a4, 0x4\n"
			"vle32.v          v3, (a6)\n"
			"add a6, a6, 0x4\n"
			"vle32.v          v4, (t1)\n"
			"add t1, t1, 0x4\n"
			"vle32.v          v5, (t3)\n"
			"add t3, t3, 0x4\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"vse32.v          v4, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"vse32.v          v5, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"addi %[blocks], %[blocks], -0x1\n"
			"bnez           %[blocks], 6b\n"
			"5:\n"
                        "flw            f0, (%[minptr])\n"
                        "vfmv.v.f          v22, f0\n"
                        "flw            f0, (%[maxptr])\n"
                        "vfmv.v.f          v23, f0\n"
			"vfmax.vv v24, v24, v22\n"
			"vfmax.vv v25, v25, v22\n"
			"vfmax.vv v26, v26, v22\n"
			"vfmax.vv v27, v27, v22\n"
			"vfmax.vv v28, v28, v22\n"
			"vfmax.vv v29, v29, v22\n"
			"vfmin.vv v24, v24, v23\n"
			"vfmin.vv v25, v25, v23\n"
			"vfmin.vv v26, v26, v23\n"
			"vfmin.vv v27, v27, v23\n"
			"vfmin.vv v28, v28, v23\n"
			"vfmin.vv v29, v29, v23\n"
			"vse32.v v24, (%[c_ptr0])\n"
			"add a1, %[c_ptr0], %[ldc]\n"
			"vse32.v v25, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v26, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v27, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v28, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v29, (a1)\n"
			"add %[c_ptr0], %[c_ptr0], 0x10\n"

			: [a_ptr0] "+r" (a_ptr0), [b_ptr0] "+r" (b_ptr0), [c_ptr0] "+r" (c_ptr0), [loops] "+r" (loops), [regs] "+r" (regs), [blocks] "+r" (blocks), [s0] "+r" (s0), [s1] "+r" (s1), [s2] "+r" (s2), [s3] "+r" (s3)
			: [width] "r" (width), [append] "r" (static_cast<uint64_t>(append)), [lda] "r" (ldab), [ldc] "r" (ldcb), [biasptr] "r" (biasptr), [minptr] "r" (minptr), [maxptr] "r" (maxptr)
			: "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7", "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15", "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23", "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31",
			  "t0", "t1", "t3", "a0", "a1", "a2", "a4", "a6", "f0"
			);
                    break;
                case 7:
       		 __asm__ __volatile__(
			"li  a0, 4\n"
			"vsetvli  t0, a0, e32, m1\n"
			
			"vle32.v          v24, (%[biasptr])\n"
			"add a2, %[a_ptr0], %[lda]\n"
			"vle32.v          v0, (%[a_ptr0])\n"
			"add a4, a2, %[lda]\n"
			"add a6, a4, %[lda]\n"
			"add t1, a6, %[lda]\n"
			"add t3, t1, %[lda]\n"
			"add t5, t3, %[lda]\n"
			"vmv.v.v v25, v24\n"
			"vmv.v.v v26, v24\n"
			"vmv.v.v v27, v24\n"
			"vmv.v.v v28, v24\n"
			"vmv.v.v v29, v24\n"
			"vmv.v.v v30, v24\n"
			"vle32.v          v1, (a2)\n"
			"vle32.v          v2, (a4)\n"
			"vle32.v          v3, (a6)\n"
			"vle32.v          v4, (t1)\n"
			"vle32.v          v5, (t3)\n"
			"vle32.v          v6, (t5)\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add %[a_ptr0], %[a_ptr0], 0x10\n"
			"add a2, a2, 0x10\n"
			"add a4, a4, 0x10\n"
			"add a6, a6, 0x10\n"
			"add t1, t1, 0x10\n"
			"add t3, t3, 0x10\n"
			"add t5, t5, 0x10\n"
			"add %[b_ptr0], %[b_ptr0], 0x40\n"
			"beqz %[loops], 1f\n"
			"2:\n"
			"add            a1, %[b_ptr0], -0x10\n"
			"vle32.v          v19, (a1)\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v4, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"vse32.v          v5, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v29, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v29, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v29, f0, v19\n"
			"vse32.v          v6, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v30, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v30, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v30, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v30, f0, v19\n"
			"vle32.v          v8, (%[a_ptr0])\n"
			"vle32.v          v9, (a2)\n"
			"vle32.v          v10, (a4)\n"
			"vle32.v          v11, (a6)\n"
			"vle32.v          v12, (t1)\n"
			"vle32.v          v13, (t3)\n"
			"vle32.v          v14, (t5)\n"
			"addi %[loops], %[loops], -0x1\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add %[a_ptr0], %[a_ptr0], 0x20\n"
			"add a2, a2, 0x20\n"
			"add a4, a4, 0x20\n"
			"add a6, a6, 0x20\n"
			"add t1, t1, 0x20\n"
			"add t3, t3, 0x20\n"
			"add t5, t5, 0x20\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add            a1, %[b_ptr0], 0x30\n"
			"vle32.v          v19, (a1)\n"
			"add            a1, %[a_ptr0], -0x10\n"
			"vle32.v          v0, (a1)\n"
			"add            a1, a2, -0x10\n"
			"vle32.v          v1, (a1)\n"
			"add            a1, a4, -0x10\n"
			"vle32.v          v2, (a1)\n"
			"add            a1, a6, -0x10\n"
			"vle32.v          v3, (a1)\n"
			"add            a1, t1, -0x10\n"
			"vle32.v          v4, (a1)\n"
			"add            a1, t3, -0x10\n"
			"vle32.v          v5, (a1)\n"
			"add            a1, t5, -0x10\n"
			"vle32.v          v6, (a1)\n"
			
			"vse32.v          v8, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v9, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v10, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v11, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v12, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"vse32.v          v13, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v29, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v29, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v29, f0, v19\n"
			"vse32.v          v14, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v30, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v30, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v30, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v30, f0, v19\n"
			"add            a1, %[b_ptr0], 0x40\n"
			"vle32.v          v16, (a1)\n"
			"add            a1, %[b_ptr0], 0x50\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x60\n"
			"vle32.v          v18, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x80\n"
			"bnez           %[loops], 2b\n"
			"1:\n"
			"add            a1, %[b_ptr0], -0x10\n"
			"vle32.v          v19, (a1)\n"
			"beqz           %[regs], 3f\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v4, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"vse32.v          v5, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v29, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v29, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v29, f0, v19\n"
			"vse32.v          v6, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v30, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v30, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v30, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v30, f0, v19\n"
			"vle32.v          v8, (%[a_ptr0])\n"
			"vle32.v          v9, (a2)\n"
			"vle32.v          v10, (a4)\n"
			"vle32.v          v11, (a6)\n"
			"vle32.v          v12, (t1)\n"
			"vle32.v          v13, (t3)\n"
			"vle32.v          v14, (t5)\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add %[a_ptr0], %[a_ptr0], 0x10\n"
			"add a2, a2, 0x10\n"
			"add a4, a4, 0x10\n"
			"add a6, a6, 0x10\n"
			"add t1, t1, 0x10\n"
			"add t3, t3, 0x10\n"
			"add t5, t5, 0x10\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add            a1, %[b_ptr0], 0x30\n"
			"vle32.v          v19, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x40\n"
			"vse32.v          v8, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v9, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v10, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v11, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v12, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"vse32.v          v13, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v29, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v29, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v29, f0, v19\n"
			"vse32.v          v14, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v30, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v30, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v30, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v30, f0, v19\n"
			"j              4f\n"
			"3:\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v4, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"vse32.v          v5, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v29, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v29, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v29, f0, v19\n"
			"vse32.v          v6, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v30, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v30, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v30, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v30, f0, v19\n"
			"4:\n"
			"beqz %[blocks], 5f\n"
			"6:\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add %[b_ptr0], %[b_ptr0], 0x10\n"
			"vle32.v          v0, (%[a_ptr0])\n"
			"add %[a_ptr0], %[a_ptr0], 0x4\n"
			"vle32.v          v1, (a2)\n"
			"add a2, a2, 0x4\n"
			"vle32.v          v2, (a4)\n"
			"add a4, a4, 0x4\n"
			"vle32.v          v3, (a6)\n"
			"add a6, a6, 0x4\n"
			"vle32.v          v4, (t1)\n"
			"add t1, t1, 0x4\n"
			"vle32.v          v5, (t3)\n"
			"add t3, t3, 0x4\n"
			"vle32.v          v6, (t5)\n"
			"add t5, t5, 0x4\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"vse32.v          v4, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"vse32.v          v5, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"vse32.v          v6, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v30, f0, v16\n"
			"addi %[blocks], %[blocks], -0x1\n"
			"bnez           %[blocks], 6b\n"
			"5:\n"
                        "flw            f0, (%[minptr])\n"
                        "vfmv.v.f          v22, f0\n"
                        "flw            f0, (%[maxptr])\n"
                        "vfmv.v.f          v23, f0\n"
			"vfmax.vv v24, v24, v22\n"
			"vfmax.vv v25, v25, v22\n"
			"vfmax.vv v26, v26, v22\n"
			"vfmax.vv v27, v27, v22\n"
			"vfmax.vv v28, v28, v22\n"
			"vfmax.vv v29, v29, v22\n"
			"vfmax.vv v30, v30, v22\n"
			"vfmin.vv v24, v24, v23\n"
			"vfmin.vv v25, v25, v23\n"
			"vfmin.vv v26, v26, v23\n"
			"vfmin.vv v27, v27, v23\n"
			"vfmin.vv v28, v28, v23\n"
			"vfmin.vv v29, v29, v23\n"
			"vfmin.vv v30, v30, v23\n"
			"vse32.v v24, (%[c_ptr0])\n"
			"add a1, %[c_ptr0], %[ldc]\n"
			"vse32.v v25, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v26, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v27, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v28, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v29, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v30, (a1)\n"
			"add %[c_ptr0], %[c_ptr0], 0x10\n"

			: [a_ptr0] "+r" (a_ptr0), [b_ptr0] "+r" (b_ptr0), [c_ptr0] "+r" (c_ptr0), [loops] "+r" (loops), [regs] "+r" (regs), [blocks] "+r" (blocks), [s0] "+r" (s0), [s1] "+r" (s1), [s2] "+r" (s2), [s3] "+r" (s3)
			: [width] "r" (width), [append] "r" (static_cast<uint64_t>(append)), [lda] "r" (ldab), [ldc] "r" (ldcb), [biasptr] "r" (biasptr), [minptr] "r" (minptr), [maxptr] "r" (maxptr)
			: "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7", "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15", "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23", "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31",
			"t0", "t1", "t3", "t5", "a0", "a1", "a2", "a4", "a6", "f0"
			);
                    break;
                default:
                case 8:
     	 	  __asm__ __volatile__(
			"li  a0, 4\n"
			"vsetvli  t0, a0, e32, m1\n"
			
			"vle32.v          v24, (%[biasptr])\n"
			"add a2, %[a_ptr0], %[lda]\n"
			"vle32.v          v0, (%[a_ptr0])\n"
			"add a4, a2, %[lda]\n"
			"add a6, a4, %[lda]\n"
			"add t1, a6, %[lda]\n"
			"add t3, t1, %[lda]\n"
			"add t5, t3, %[lda]\n"
			"add a3, t5, %[lda]\n"
			"vmv.v.v v25, v24\n"
			"vmv.v.v v26, v24\n"
			"vmv.v.v v27, v24\n"
			"vmv.v.v v28, v24\n"
			"vmv.v.v v29, v24\n"
			"vmv.v.v v30, v24\n"
			"vmv.v.v v31, v24\n"
			"vle32.v          v1, (a2)\n"
			"vle32.v          v2, (a4)\n"
			"vle32.v          v3, (a6)\n"
			"vle32.v          v4, (t1)\n"
			"vle32.v          v5, (t3)\n"
			"vle32.v          v6, (t5)\n"
			"vle32.v          v7, (a3)\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add %[a_ptr0], %[a_ptr0], 0x10\n"
			"add a2, a2, 0x10\n"
			"add a4, a4, 0x10\n"
			"add a6, a6, 0x10\n"
			"add t1, t1, 0x10\n"
			"add t3, t3, 0x10\n"
			"add t5, t5, 0x10\n"
			"add a3, a3, 0x10\n"
			"add %[b_ptr0], %[b_ptr0], 0x40\n"
			"beqz %[loops], 1f\n"
			"2:\n"
			"add            a1, %[b_ptr0], -0x10\n"
			"vle32.v          v19, (a1)\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v4, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"vse32.v          v5, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v29, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v29, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v29, f0, v19\n"
			"vse32.v          v6, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v30, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v30, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v30, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v30, f0, v19\n"
			"vse32.v          v7, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v31, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v31, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v31, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v31, f0, v19\n"
			"vle32.v          v8, (%[a_ptr0])\n"
			"vle32.v          v9, (a2)\n"
			"vle32.v          v10, (a4)\n"
			"vle32.v          v11, (a6)\n"
			"vle32.v          v12, (t1)\n"
			"vle32.v          v13, (t3)\n"
			"vle32.v          v14, (t5)\n"
			"vle32.v          v15, (a3)\n"
			"addi %[loops], %[loops], -0x1\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add %[a_ptr0], %[a_ptr0], 0x20\n"
			"add a2, a2, 0x20\n"
			"add a4, a4, 0x20\n"
			"add a6, a6, 0x20\n"
			"add t1, t1, 0x20\n"
			"add t3, t3, 0x20\n"
			"add t5, t5, 0x20\n"
			"add a3, a3, 0x20\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add            a1, %[b_ptr0], 0x30\n"
			"vle32.v          v19, (a1)\n"
			"add            a1, %[a_ptr0], -0x10\n"
			"vle32.v          v0, (a1)\n"
			"add            a1, a2, -0x10\n"
			"vle32.v          v1, (a1)\n"
			"add            a1, a4, -0x10\n"
			"vle32.v          v2, (a1)\n"
			"add            a1, a6, -0x10\n"
			"vle32.v          v3, (a1)\n"
			"add            a1, t1, -0x10\n"
			"vle32.v          v4, (a1)\n"
			"add            a1, t3, -0x10\n"
			"vle32.v          v5, (a1)\n"
			"add            a1, t5, -0x10\n"
			"vle32.v          v6, (a1)\n"
			"add            a1, a3, -0x10\n"
			"vle32.v          v7, (a1)\n"
			
			"vse32.v          v8, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v9, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v10, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v11, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v12, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"vse32.v          v13, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v29, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v29, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v29, f0, v19\n"
			"vse32.v          v14, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v30, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v30, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v30, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v30, f0, v19\n"
			"vse32.v          v15, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v31, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v31, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v31, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v31, f0, v19\n"
			"add            a1, %[b_ptr0], 0x40\n"
			"vle32.v          v16, (a1)\n"
			"add            a1, %[b_ptr0], 0x50\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x60\n"
			"vle32.v          v18, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x80\n"
			"bnez           %[loops], 2b\n"
			"1:\n"
			"add            a1, %[b_ptr0], -0x10\n"
			"vle32.v          v19, (a1)\n"
			"beqz           %[regs], 3f\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v4, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"vse32.v          v5, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v29, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v29, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v29, f0, v19\n"
			"vse32.v          v6, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v30, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v30, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v30, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v30, f0, v19\n"
			"vse32.v          v7, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v31, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v31, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v31, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v31, f0, v19\n"
			"vle32.v          v8, (%[a_ptr0])\n"
			"vle32.v          v9, (a2)\n"
			"vle32.v          v10, (a4)\n"
			"vle32.v          v11, (a6)\n"
			"vle32.v          v12, (t1)\n"
			"vle32.v          v13, (t3)\n"
			"vle32.v          v14, (t5)\n"
			"vle32.v          v15, (a3)\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add %[a_ptr0], %[a_ptr0], 0x10\n"
			"add a2, a2, 0x10\n"
			"add a4, a4, 0x10\n"
			"add a6, a6, 0x10\n"
			"add t1, t1, 0x10\n"
			"add t3, t3, 0x10\n"
			"add t5, t5, 0x10\n"
			"add a3, a3, 0x10\n"
			"add            a1, %[b_ptr0], 0x10\n"
			"vle32.v          v17, (a1)\n"
			"add            a1, %[b_ptr0], 0x20\n"
			"vle32.v          v18, (a1)\n"
			"add            a1, %[b_ptr0], 0x30\n"
			"vle32.v          v19, (a1)\n"
			"add %[b_ptr0], %[b_ptr0], 0x40\n"
			"vse32.v          v8, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v9, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v10, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v11, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v12, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"vse32.v          v13, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v29, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v29, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v29, f0, v19\n"
			"vse32.v          v14, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v30, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v30, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v30, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v30, f0, v19\n"
			"vse32.v          v15, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v31, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v31, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v31, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v31, f0, v19\n"
			"j              4f\n"
			"3:\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v24, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v24, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v24, f0, v19\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v25, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v25, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v25, f0, v19\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v26, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v26, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v26, f0, v19\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v27, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v27, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v27, f0, v19\n"
			"vse32.v          v4, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v28, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v28, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v28, f0, v19\n"
			"vse32.v          v5, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v29, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v29, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v29, f0, v19\n"
			"vse32.v          v6, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v30, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v30, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v30, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v30, f0, v19\n"
			"vse32.v          v7, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v31, f0, v16\n"
			"flw            f0, (%[s1])\n"
			"vfmacc.vf      v31, f0, v17\n"
			"flw            f0, (%[s2])\n"
			"vfmacc.vf      v31, f0, v18\n"
			"flw            f0, (%[s3])\n"
			"vfmacc.vf      v31, f0, v19\n"
			"4:\n"
			"beqz %[blocks], 5f\n"
			"6:\n"
			"vle32.v          v16, (%[b_ptr0])\n"
			"add %[b_ptr0], %[b_ptr0], 0x10\n"
			"vle32.v          v0, (%[a_ptr0])\n"
			"add %[a_ptr0], %[a_ptr0], 0x4\n"
			"vle32.v          v1, (a2)\n"
			"add a2, a2, 0x4\n"
			"vle32.v          v2, (a4)\n"
			"add a4, a4, 0x4\n"
			"vle32.v          v3, (a6)\n"
			"add a6, a6, 0x4\n"
			"vle32.v          v4, (t1)\n"
			"add t1, t1, 0x4\n"
			"vle32.v          v5, (t3)\n"
			"add t3, t3, 0x4\n"
			"vle32.v          v6, (t5)\n"
			"add t5, t5, 0x4\n"
			"vle32.v          v7, (a3)\n"
			"add a3, a3, 0x4\n"
			"vse32.v          v0, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v24, f0, v16\n"
			"vse32.v          v1, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v25, f0, v16\n"
			"vse32.v          v2, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v26, f0, v16\n"
			"vse32.v          v3, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v27, f0, v16\n"
			"vse32.v          v4, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v28, f0, v16\n"
			"vse32.v          v5, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v29, f0, v16\n"
			"vse32.v          v6, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v30, f0, v16\n"
			"vse32.v          v7, (%[s0])\n"
			"flw            f0, (%[s0])\n"
			"vfmacc.vf      v31, f0, v16\n"
			"addi %[blocks], %[blocks], -0x1\n"
			"bnez           %[blocks], 6b\n"
			"5:\n"
                        "flw            f0, (%[minptr])\n"
                        "vfmv.v.f          v22, f0\n"
                        "flw            f0, (%[maxptr])\n"
                        "vfmv.v.f          v23, f0\n"
			"vfmax.vv v24, v24, v22\n"
			"vfmax.vv v25, v25, v22\n"
			"vfmax.vv v26, v26, v22\n"
			"vfmax.vv v27, v27, v22\n"
			"vfmax.vv v28, v28, v22\n"
			"vfmax.vv v29, v29, v22\n"
			"vfmax.vv v30, v30, v22\n"
			"vfmax.vv v31, v31, v22\n"
			"vfmin.vv v24, v24, v23\n"
			"vfmin.vv v25, v25, v23\n"
			"vfmin.vv v26, v26, v23\n"
			"vfmin.vv v27, v27, v23\n"
			"vfmin.vv v28, v28, v23\n"
			"vfmin.vv v29, v29, v23\n"
			"vfmin.vv v30, v30, v23\n"
			"vfmin.vv v31, v31, v23\n"
			"vse32.v v24, (%[c_ptr0])\n"
			"add a1, %[c_ptr0], %[ldc]\n"
			"vse32.v v25, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v26, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v27, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v28, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v29, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v30, (a1)\n"
			"add a1, a1, %[ldc]\n"
			"vse32.v v31, (a1)\n"
			"add %[c_ptr0], %[c_ptr0], 0x10\n"

			: [a_ptr0] "+r" (a_ptr0), [b_ptr0] "+r" (b_ptr0), [c_ptr0] "+r" (c_ptr0), [loops] "+r" (loops), [regs] "+r" (regs), [blocks] "+r" (blocks), [s0] "+r" (s0), [s1] "+r" (s1), [s2] "+r" (s2), [s3] "+r" (s3)
			: [width] "r" (width), [append] "r" (static_cast<uint64_t>(append)), [lda] "r" (ldab), [ldc] "r" (ldcb), [biasptr] "r" (biasptr), [minptr] "r" (minptr), [maxptr] "r" (maxptr)
			: "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7", "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15", "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23", "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31",
			  "a3", "t0", "t1", "t3", "t5", "a0", "a1", "a2", "a4", "a6", "f0"
			);
                    break;
            }
            if (use_result_buffer) {
                for(int cy=0; cy<std::min(M-y, 8); cy++) {
                    for(unsigned int cx=0; cx<width; cx++) {
                        c_ptr_real[cy * ldc + cx] = result_buffer[cy * 4 + cx];
                    }
                }
            }
        }
    }
}

} // namespace arm_gemm

#endif // __aarch64__
